-- 1.1
USE oocl;

SELECT 
    p.packageId,
    CONCAT(s.firstName, ' ', s.lastName) AS senderName,
    CONCAT(r.firstName, ' ', r.lastName) AS recipientName,
    CONCAT(c.firstName, ' ', c.lastName) AS courierName,
    c.vehicleType
FROM package p
JOIN customer s ON p.senderId = s.customerId
JOIN customer r ON p.recipientId = r.customerId
LEFT JOIN courier c ON p.courierId = c.courierId;


-- 1.2
USE oocltest;

SELECT 
    c.customerId,
    CONCAT(c.firstName, ' ', c.lastName) AS fullName,
    c.emailAddress
FROM customer c
WHERE NOT EXISTS (
    SELECT 1
    FROM package p
    WHERE p.senderId = c.customerId
);

-- 1.3
USE oocltest;

WITH RECURSIVE TrackingChain AS (
    SELECT 
        te.eventId,
        te.packageId,
        te.description,
        te.packageStatus,
        1 AS step
    FROM tracking_event te
    WHERE te.eventId = 1  -- change as needed to a starting point

    UNION ALL

    SELECT 
        te.eventId,
        te.packageId,
        te.description,
        te.packageStatus,
        tc.step + 1
    FROM tracking_event te
    JOIN TrackingChain tc ON te.packageId = tc.packageId
    WHERE te.eventId > tc.eventId
)
SELECT * FROM TrackingChain
ORDER BY step;



--  



